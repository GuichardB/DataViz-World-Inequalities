---
title: "Visualisations Baptiste"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Import des library

```{r message = FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(reshape2)
library(ggthemes)
```

## Import des données

```{r message = FALSE}
world_region_data <- read_delim("data/World_Region_Data/world_region_data.csv", 
    ";", escape_double = FALSE, trim_ws = TRUE)
```
```{r message = FALSE}
world_region_data2 <- read_delim("data/World_Region_Data/world_region_data2.csv", 
    ";", escape_double = FALSE, trim_ws = TRUE)

world_country_data1 <- read_delim("data/World_Country_Data/world_country_data1.csv", 
    ";", escape_double = FALSE, trim_ws = TRUE)

world_country_data2 <- read_delim("data/World_Country_Data/world_country_data2.csv", 
    ";", escape_double = FALSE, trim_ws = TRUE)

world_country_data3 <- read_delim("data/World_Country_Data/world_country_data3.csv", 
    ";", escape_double = FALSE, trim_ws = TRUE)
```

## Agrégation des 2 datasets

```{r}
merged <- merge(x = world_region_data, y = world_region_data2, by = "Year", all = TRUE)
old_dataset <- data.frame(merged)
old_dataset <- tibble(dataset)


merged1 <- merge(x = world_country_data1, y = world_country_data2, by = "Year", all = TRUE)
merged2 <- merge(x = merged1, y = world_country_data3, by = "Year", all = TRUE)
dataset <- data.frame(merged2)
dataset <- tibble(dataset)

head(dataset)
```

```{r}
test <- dataset %>% melt(id.vars="Year")
head(test)


PatGouvdataset <- world_country_data1 %>% select("Year", ends_with("PatrimoineGouvernement"))
PatPrivdataset <- world_country_data1 %>% select("Year", ends_with("PatrimoinePrivé"))
PIBdataset <- world_country_data1 %>% select("Year", ends_with("PIB"))
RatioPatRevdataset <- world_country_data1 %>% select("Year", ends_with("RatioPatrimoineRevenu"))
RevNatdataset <- world_country_data2 %>% select("Year", ends_with("RevenuNational"))
RevNatTop10dataset <- world_country_data2 %>% select("Year", ends_with("RevenuNationalPT(Top10%)"))
RevNatBottom50dataset <- world_country_data2 %>% select("Year", ends_with("RevenuNationalPT(Bottom50%)"))
RevNatTop1dataset <- world_country_data2 %>% select("Year", ends_with("RevenuNationalPT(Top1%)"))
RevNatMedium40dataset <- world_country_data2 %>% select("Year", ends_with("RevenuNationalPT(Medium40%)"))
CapNatdataset <- world_country_data3 %>% select("Year", ends_with("CapitalNational"))
PatTop10 <- dataset %>% select("Year", ends_with("Patrimoine.Top10.."))
PatMedium40 <- dataset %>% select("Year", ends_with("Patrimoine.Medium40.."))
PatBottom50 <- dataset %>% select("Year", ends_with("Patrimoine.Bottom50.."))
PatTop1 <- dataset %>% select("Year", ends_with("Patrimoine.Top1.."))

tempdataset <- PatGouvdataset %>% rename("France"=France_PatrimoineGouvernement,"Afrique du Sud"=AfriqueSud_PatrimoineGouvernement, "Australie"=Australie_PatrimoineGouvernement, "Canada"=Canada_PatrimoineGouvernement, "Chine"=Chine_PatrimoineGouvernement, "Danemark"=Danemark_PatrimoineGouvernement, "Inde"=Inde_PatrimoineGouvernement, "Royaume-Uni"=RU_PatrimoineGouvernement, "Japon"=Japon_PatrimoineGouvernement, "Mexique"=Mexique_PatrimoineGouvernement, "Russie"=Russie_PatrimoineGouvernement, "Etats-Unis"=US_PatrimoineGouvernement) %>%
melt(id.vars="Year") %>%
mutate(PatrimoineGouvernement = value)%>%
subset (select = -value)

tempdataset2 <- PatPrivdataset %>% rename("France"=France_PatrimoinePrivé,"Afrique du Sud"=AfriqueSud_PatrimoinePrivé, "Australie"=Australie_PatrimoinePrivé, "Canada"=Canada_PatrimoinePrivé, "Chine"=Chine_PatrimoinePrivé, "Danemark"=Danemark_PatrimoinePrivé, "Inde"=Inde_PatrimoinePrivé, "Royaume-Uni"=RU_PatrimoinePrivé, "Japon"=Japon_PatrimoinePrivé, "Mexique"=Mexique_PatrimoinePrivé, "Russie"=Russie_PatrimoinePrivé, "Etats-Unis"=US_PatrimoinePrivé) %>%
melt(id.vars="Year") %>%
mutate(PatrimoinePrivé = value)%>%
subset (select = -value)

tempdataset3 <- PIBdataset %>% rename("France"=France_PIB,"Afrique du Sud"=AfriqueSud_PIB, "Australie"=Australie_PIB, "Canada"=Canada_PIB, "Chine"=Chine_PIB, "Danemark"=Danemark_PIB, "Inde"=Inde_PIB, "Royaume-Uni"=RU_PIB, "Japon"=Japon_PIB, "Mexique"=Mexique_PIB, "Russie"=Russie_PIB, "Etats-Unis"=US_PIB) %>%
melt(id.vars="Year") %>%
mutate(PIB = value)%>%
subset (select = -value)

tempdataset4 <- RatioPatRevdataset %>% rename("France"=France_RatioPatrimoineRevenu,"Afrique du Sud"=AfriqueSud_RatioPatrimoineRevenu, "Australie"=Australie_RatioPatrimoineRevenu, "Canada"=Canada_RatioPatrimoineRevenu, "Chine"=Chine_RatioPatrimoineRevenu, "Danemark"=Danemark_RatioPatrimoineRevenu, "Inde"=Inde_RatioPatrimoineRevenu, "Royaume-Uni"=RU_RatioPatrimoineRevenu, "Japon"=Japon_RatioPatrimoineRevenu, "Mexique"=Mexique_RatioPatrimoineRevenu, "Russie"=Russie_RatioPatrimoineRevenu, "Etats-Unis"=US_RatioPatrimoineRevenu) %>%
melt(id.vars="Year") %>%
mutate(RatioPatrimoineRevenu = value)%>%
subset (select = -value)

final_dataset <- merge(x = tempdataset, y = tempdataset2, by = c("Year", "variable"), all = TRUE)
final_dataset <- merge(x = final_dataset, y = tempdataset3, by = c("Year", "variable"), all = TRUE)
final_dataset <- merge(x = final_dataset, y = tempdataset4, by = c("Year", "variable"), all = TRUE)

final_dataset <- final_dataset %>% rename(Region=variable)
  
head(final_dataset)
```



## Création de sous-datasets pour séparer les données par indicateurs

```{r}
NIdataset <- dataset %>% select("Year", ends_with("NI"))
GDPdataset <- dataset %>% select("Year", ends_with("GDP"))
PTNIB40dataset <- dataset %>% select("Year", ends_with("PTNIB40"))
PTNIB50dataset <- dataset %>% select("Year", ends_with("PTNIB50"))
PTNIT1dataset <- dataset %>% select("Year", ends_with("PTNIT1"))
PTNIT10dataset <- dataset %>% select("Year", ends_with("PTNIT10"))
PTNIM40dataset <- dataset %>% select("Year", ends_with("PTNIM40"))
```

## Visualisation rapide des données
```{r}
head(PTNIB40dataset)

```

## Tests de graphiques généraux

```{r}
# Traitement du dataset PTNIT10 et PTNIB40
newdataset <- PTNIT10dataset %>% rename("Western Europe"=WesternEuropePTNIT10, Asia=AsiaPTNIT10, "Eastern Europe"=EasternEuropePTNIT10, "Northern America"=NorthernAmericaPTNIT10, Oceania=OceaniaPTNIT10, "Latin America"=LatinAmericaPTNIT10, Africa=AfricaPTNIT10) %>%
melt(id.vars="Year") %>%
filter(variable=="Western Europe"|variable=="Asia"|variable=="Eastern Europe"|variable=="Northern America"|variable=="Oceania"|variable=="Latin America"|variable=="Africa")%>%
mutate(value_in_percent = value*100)

newdataset2 <- PTNIB50dataset %>% rename("Western Europe"=WesternEuropePTNIB50, Asia=AsiaPTNIB50, "Eastern Europe"=EasternEuropePTNIB50, "Northern America"=NorthernAmericaPTNIB50, Oceania=OceaniaPTNIB50, "Latin America"=LatinAmericaPTNIB50, Africa=AfricaPTNIB50) %>%
melt(id.vars="Year") %>%
filter(variable=="Western Europe"|variable=="Asia"|variable=="Eastern Europe"|variable=="Northern America"|variable=="Oceania"|variable=="Latin America"|variable=="Africa") %>%
mutate(value_in_percent = value*100)


newdataset3 <- PTNIT1dataset %>% rename("Western Europe"=WesternEuropePTNIT1, Asia=AsiaPTNIT1, "Eastern Europe"=EasternEuropePTNIT1, "Northern America"=NorthernAmericaPTNIT1, Oceania=OceaniaPTNIT1, "Latin America"=LatinAmericaPTNIT1, Africa=AfricaPTNIT1) %>%
melt(id.vars="Year") %>%
filter(variable=="Western Europe"|variable=="Asia"|variable=="Eastern Europe"|variable=="Northern America"|variable=="Oceania"|variable=="Latin America"|variable=="Africa")%>%
mutate(value_in_percent = value*100)

```


```{r}

# Part des Top 10% de la population dans le revenu national en 2019
newdataset %>% filter(Year == "2019") %>%
ggplot(aes(x= reorder(variable, -value), y=value_in_percent, fill=variable)) + geom_bar(stat="identity") + ylim(0,65) + geom_text(aes(label=paste0(value_in_percent, "%"), hjust=-0.1))+ labs(title="Part des Top 10% de la population dans le revenu national en 2019", x="Régions du monde", y = "Part du revenu national (%)") + scale_fill_brewer(palette = "Pastel1") + coord_flip() +  theme_hc()+ scale_colour_hc() + theme(legend.position = "none", plot.title = element_text(size = rel(1.2), hjust = 12))

```


```{r}
#Evolution de la part des Top 10% dans le revenu national, de 1980 à 2019
newdataset %>% ggplot(aes(x=Year, y=value_in_percent, group = variable, color = variable))+geom_line() + labs(title="Evolution de la part des Top 10% dans le revenu national, de 1980 à 2019", x="Année", y = "Part du revenu national (%)")

```



```{r}

# Part des Bottom 50% de la population dans le revenu national en 2019
newdataset2 %>% filter(Year == "2019") %>%
ggplot(aes(x= reorder(variable, -value), y=value_in_percent, fill=variable)) + geom_bar(stat="identity") + ylim(0,65) + geom_text(aes(label=paste0(value_in_percent, "%"), hjust=-0.1))+ labs(title="Part des Bottom 50% de la population dans le revenu national en 2019", x="Régions du monde", y = "Part du revenu national (%)") + scale_fill_brewer(palette = "Pastel1") + coord_flip()  +  theme_hc()+ scale_colour_hc() + theme(legend.position = "none", plot.title = element_text(size = rel(1.2), hjust = 2.5))

```

```{r}
#Evolution de la part des Bottom 50% dans le revenu national, de 1980 à 2019
newdataset2 %>% ggplot(aes(x=Year, y=value_in_percent, group = variable, color = variable))+geom_line() + labs(title="Evolution de la part des Bottom 50% dans le revenu national, de 1980 à 2019", x="Année", y = "Part du revenu national (%)")

```


```{r}
#Comparaison de l'evolution de la Parts du revenu national des 1% supérieurs et des 50% inférieurs en Amérique du Nord, de 1980 à 2019
dataset %>% select("Year", "NorthernAmericaPTNIT1", "NorthernAmericaPTNIB50") %>% mutate(Top1=NorthernAmericaPTNIT1*100) %>% mutate(Bottom50=NorthernAmericaPTNIB50*100) %>%
ggplot(aes(x=Year))+geom_line(aes(y=Top1), color="red") +geom_line(aes(y=Bottom50), color="blue") + labs(title="Comparaison de l'evolution de la Parts du revenu national des 1% supérieurs et des 50% inférieurs en Amérique du Nord, de 1980 à 2019", x="Année", y = "Part du revenu national (%)")

```


```{r}
#Comparaison de l'evolution de la Parts du revenu national des 1% supérieurs et des 50% inférieurs en Europe de l'Ouest, de 1980 à 2019
dataset %>% select("Year", "WesternEuropePTNIT1", "WesternEuropePTNIB50") %>% mutate(Top1=WesternEuropePTNIT1*100) %>% mutate(Bottom50=WesternEuropePTNIB50*100) %>%
ggplot(aes(x=Year))+geom_line(aes(y=Top1), color="red") +geom_line(aes(y=Bottom50), color="blue") + labs(title="Comparaison de l'evolution de la Parts du revenu national des 1% supérieurs et des 50% inférieurs en Europe de l'Ouest, de 1980 à 2019", x="Année", y = "Part du revenu national (%)")

```